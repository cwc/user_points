# UserPoints

To start the server:

  * Install dependencies with `mix deps.get`
  * Verify that your Postgres connection details are correct in config/dev.exs
  * Create and migrate your database with `mix ecto.setup` (generating the users takes a bit)
  * `mix phx.server`

Navigate to or curl http://localhost:4000 to see the API response. Data is updated every 60 seconds.

## Requirements

Follow these requirements :

- A good README
- Use postgres
- `mix ecto.setup` will create a `Users` table with 3 columns, id, points and timestamps.
    - `id` is autogenerated so no worries
    - `points` an integer that accepts any number between 0 and 100
    - `timestamps` autogenerated by ecto
    - This should generate 1.000.000 user seeds, each with 0 points.
- The app should start when you run without warnings or errors using: `mix phx.server`
- When the app starts, a `genserver` should be launched which will:
    - Have 2 elements as state:
        - A random number (let's call it the `max_number`), [0 - 100]
        - A timestamp (which indicates the last time someone queried the genserver, defaults to `nil` for the first query)
    - Run every minute and when it runs:
        - Should update every user's points in the database (using a random number generator [0-100] for each)
        - Refresh the `max_number` of the genserver state with a new random number
    - Should accept a `handle_call` that:
        - Queries the database for all users with more points than `max_number` but only retrieve a max of 2 users.
        - Updates the genserver state `timestamp` with the current timestamp
        - Returns the users and timestamp of the **previous `handle_call`**

- Build a single endpoint, root `/`:
    - This can be handled by an action which will call the previously mentioned `genserver` and return the result.

Something like:

`GET localhost:3000/`

```elixir
{
  'users': [{id: 1, points: 30}, {id: 72, points: 30}],
  'timestamp': `2020-07-30 17:09:33`
}
```
